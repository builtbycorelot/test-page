---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getEntry, getCollection } from 'astro:content';

export async function getStaticPaths() {
  const landEntries = await getCollection('land');
  return landEntries.map((entry) => ({
    params: { slug: entry.id },
  }));
}

const { slug } = Astro.params;
const parcel = await getEntry('land', slug!);

if (!parcel) {
  throw new Error(`Land entry not found for slug ${slug}`);
}

const breadcrumbLd = {
  '@context': 'https://schema.org',
  '@type': 'BreadcrumbList',
  itemListElement: [
    { '@type': 'ListItem', position: 1, name: 'Land', item: '/land/' },
    { '@type': 'ListItem', position: 2, name: parcel.data.address, item: `/land/${slug}/` },
  ],
};

const nearby = (await getCollection('land')).filter((item) => item.id !== slug).slice(0, 2);
---
<BaseLayout
  title={`${parcel.data.address} | CORELOT Land`}
  description={parcel.data.summary ?? `${parcel.data.address} ${parcel.data.status}`}
  canonicalPath={`/land/${slug}/`}
  structuredData={breadcrumbLd}
>
  <header class="page-header">
    <p class="pill">Homesite</p>
    <h1>{parcel.data.address}</h1>
    <p class="stats">Status: {parcel.data.status}</p>
    {parcel.data.summary && <p class="lede">{parcel.data.summary}</p>}
  </header>

  <img class="hero" src={parcel.data.heroImage} alt={`${parcel.data.address} homesite`} />

  <section class="details">
    <div>
      <h2>Ready to build</h2>
      <ul>
        <li>Pair with WL Martin plan packages.</li>
        <li>Site-specific budget review before contract.</li>
        <li>Utility coordination and permitting support.</li>
      </ul>
    </div>
    <div>
      <h2>Gallery</h2>
      <div class="gallery">
        {parcel.data.gallery.map((image) => (
          <img src={image} alt={`${parcel.data.address} gallery`} loading="lazy" />
        ))}
      </div>
    </div>
  </section>

  {nearby.length > 0 && (
    <section>
      <h2>Nearby opportunities</h2>
      <div class="grid">
        {nearby.map((lot) => <a class="inline-card" href={`/land/${lot.id}/`}>{lot.data.address}</a>)}
      </div>
    </section>
  )}
</BaseLayout>

<style>
.page-header { margin-bottom: 1rem; }
.stats { color: #4b5563; }
.lede { color: #4b5563; max-width: 70ch; }
.hero {
  width: 100%;
  max-height: 420px;
  object-fit: cover;
  border-radius: 12px;
  border: 1px solid #ececec;
}
.details {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
  gap: 1.5rem;
  margin-top: 1.5rem;
}
.gallery {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
  gap: 0.75rem;
}
.gallery img {
  width: 100%;
  border-radius: 10px;
  border: 1px solid #ececec;
}
.grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
  gap: 0.75rem;
}
.inline-card {
  display: block;
  border: 1px solid #ececec;
  border-radius: 10px;
  padding: 0.75rem 0.9rem;
  background: #f8f9fb;
  color: #0d2340;
  text-decoration: none;
  font-weight: 700;
}
.inline-card:hover { border-color: #cc5500; }
</style>
