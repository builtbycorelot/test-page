---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const plans = (await getCollection('plans')).sort((a, b) => b.data.sqft - a.data.sqft);
const land = (await getCollection('land')).sort((a, b) => a.data.address.localeCompare(b.data.address));

// Main site pages with hero images
const sitePages = [
  {
    title: 'About CORELOT',
    slug: '/about',
    description: 'Company story, service area, and what sets us apart',
    heroImage: '/images/brands/corelot.svg',
    category: 'Company'
  },
  {
    title: 'Build Process',
    slug: '/process',
    description: '8-phase timeline from consultation to final walkthrough',
    heroImage: '/images/brands/corelot.svg',
    category: 'Resources'
  },
  {
    title: 'Financing Guide',
    slug: '/financing',
    description: 'Construction-perm loans and trusted lender partners',
    heroImage: '/images/brands/corelot.svg',
    category: 'Resources'
  },
  {
    title: 'Frequently Asked Questions',
    slug: '/faq',
    description: '40+ Q&As about land, process, budget, and more',
    heroImage: '/images/brands/corelot.svg',
    category: 'Resources'
  },
  {
    title: 'Contact Us',
    slug: '/contact',
    description: 'Schedule a consultation to discuss your project',
    heroImage: '/images/brands/corelot.svg',
    category: 'Company'
  },
  {
    title: 'Floor Plans',
    slug: '/plans',
    description: `${plans.length} plans including CORELOT and WL Martin designs`,
    heroImage: '/images/brands/corelot.svg',
    category: 'Catalog'
  },
  {
    title: 'Available Land',
    slug: '/land',
    description: `${land.length} homesites ready for construction`,
    heroImage: '/images/brands/corelot.svg',
    category: 'Catalog'
  },
];

const assetPages = [
  { title: 'Brand capability matrix', href: '/assets/brand-capability-matrix.html' },
  { title: 'Brand guide', href: '/assets/brand-guide.html' },
  { title: 'Community brochure', href: '/assets/community-brochure.html' },
  { title: 'Email template', href: '/assets/email-template.html' },
  { title: 'House plan brochures', href: '/assets/house-plan-brochures.html' },
  { title: 'Single home email', href: '/assets/single-home-email.html' },
  { title: 'Single home social', href: '/assets/single-home-social.html' },
  { title: 'Site plan exhibit', href: '/assets/site-plan-exhibit.html' },
  { title: 'Spot lot flyer', href: '/assets/spot-lot-flyer.html' },
  { title: 'Subdivision email', href: '/assets/subdivision-email.html' }
];

const marketingPages = [
  { title: 'Add Scott Hine', href: '/marketing/add-scott-hine.html' },
  { title: 'Analytics', href: '/marketing/analytics.html' },
  { title: 'Google Ads', href: '/marketing/google-ads.html' },
  { title: 'Houzz', href: '/marketing/houzz.html' },
  { title: 'Lot catalog', href: '/marketing/lot-catalog.html' },
  { title: 'Plan catalog', href: '/marketing/plan-catalog.html' },
  { title: 'White Oak sign', href: '/marketing/white-oak-sign.html' }
];

const blogPages = [
  'add-value-home','affordable-meaning','beautiful-lawn-guide','build-on-your-lot','construction-perm-loan-benefits','corelot-design-process','corelot-products','financing-overview','home-style-selection','house-lot-options','house-match','lot-affordability','lot-feasibility','low-maintenance-homes','planning-pricing-wlmartin','production-vs-custom','restaurant-vs-builder','sales-process','the-lot','warranty-cost','what-is-quality','who-is-corelot','why-rent-own'
].map((slug) => ({
  title: slug.split('-').map((part) => part.charAt(0).toUpperCase() + part.slice(1)).join(' '),
  href: `/blogs/${slug}.html`
}));

const otherPages = [
  { title: 'Legacy index', href: '/legacy-index.html' },
  { title: 'Operations map', href: '/CORELOT%20Operations%20Map.html' },
  { title: 'Invoice & Statement Standard', href: '/INVOICE_AND_STATEMENT_STANDARD.md' }
];

const structuredData = [
  {
    '@context': 'https://schema.org',
    '@type': 'ItemList',
    name: 'CORELOT Plans',
    itemListElement: plans.map((plan, index) => ({
      '@type': 'ListItem',
      position: index + 1,
      url: `/plans/${plan.id}/`,
      name: plan.data.title,
    })),
  },
  {
    '@context': 'https://schema.org',
    '@type': 'ItemList',
    name: 'Available Land',
    itemListElement: land.map((lot, index) => ({
      '@type': 'ListItem',
      position: index + 1,
      url: `/land/${lot.id}/`,
      name: lot.data.address,
    })),
  },
];
---
<BaseLayout
  title="CORELOT Homes | Site Catalog"
  description="Browse all pages, floor plans, and resources for CORELOT Homes—your on-your-lot builder in Virginia."
  canonicalPath="/"
  structuredData={structuredData}
>
  <header class="catalog-header">
    <h1>CORELOT Homes Site Catalog</h1>
    <p class="lede">Browse all pages, plans, and resources. Each page includes its slug (URL path) for easy reference.</p>
  </header>

  <section class="catalog-section">
    <h2>Main Site Pages</h2>
    <div class="catalog-grid">
      {sitePages.map((page) => (
        <a href={page.slug} class="catalog-card">
          <div class="catalog-image">
            <img src={page.heroImage} alt={page.title} />
          </div>
          <div class="catalog-content">
            <p class="catalog-category">{page.category}</p>
            <h3>{page.title}</h3>
            <p class="catalog-description">{page.description}</p>
            <p class="catalog-slug">{page.slug}</p>
          </div>
        </a>
      ))}
    </div>
  </section>

  <section class="catalog-section">
    <h2>Floor Plans ({plans.length})</h2>
    <div class="catalog-grid">
      {plans.map((plan) => (
        <a href={`/plans/${plan.id}/`} class="catalog-card">
          <div class="catalog-image">
            <img src={plan.data.heroImage} alt={plan.data.title} />
          </div>
          <div class="catalog-content">
            <p class="catalog-category">{plan.data.category}</p>
            <h3>{plan.data.title}</h3>
            <p class="catalog-description">{plan.data.sqft} sqft • {plan.data.beds} beds • {plan.data.baths} baths</p>
            <p class="catalog-slug">/plans/{plan.id}/</p>
          </div>
        </a>
      ))}
    </div>
  </section>

  <section class="catalog-section">
    <h2>Available Land ({land.length})</h2>
    <div class="catalog-grid">
      {land.map((parcel) => (
        <a href={`/land/${parcel.id}/`} class="catalog-card">
          <div class="catalog-image">
            <img src={parcel.data.heroImage} alt={parcel.data.address} />
          </div>
          <div class="catalog-content">
            <p class="catalog-category">Homesite</p>
            <h3>{parcel.data.address}</h3>
            <p class="catalog-description">{parcel.data.status}</p>
            <p class="catalog-slug">/land/{parcel.id}/</p>
          </div>
        </a>
      ))}
    </div>
  </section>

  <section id="library">
    <h2>Full site library</h2>
    <p>Every existing page remains available and is linked below for fast access.</p>
    <div class="link-grid">
      <div>
        <h3>Blogs</h3>
        <ul>
          {blogPages.map((page) => (
            <li><a href={page.href}>{page.title}</a></li>
          ))}
        </ul>
      </div>
      <div>
        <h3>Marketing</h3>
        <ul>
          {marketingPages.map((page) => (
            <li><a href={page.href}>{page.title}</a></li>
          ))}
        </ul>
      </div>
      <div>
        <h3>Assets</h3>
        <ul>
          {assetPages.map((page) => (
            <li><a href={page.href}>{page.title}</a></li>
          ))}
        </ul>
      </div>
      <div>
        <h3>Site Pages</h3>
        <ul>
          <li><a href="/plans">Plans Index</a></li>
          <li><a href="/land">Land Index</a></li>
          <li><a href="/about">About CORELOT</a></li>
          <li><a href="/process">Build Process</a></li>
          <li><a href="/financing">Financing Guide</a></li>
          <li><a href="/faq">Frequently Asked Questions</a></li>
          <li><a href="/contact">Contact Us</a></li>
        </ul>
      </div>
      <div>
        <h3>Other references</h3>
        <ul>
          {otherPages.map((page) => (
            <li><a href={page.href}>{page.title}</a></li>
          ))}
        </ul>
      </div>
    </div>
  </section>
</BaseLayout>

<style>
.catalog-header {
  text-align: center;
  margin-bottom: 3rem;
  padding-bottom: 2rem;
  border-bottom: 2px solid #e5e7eb;
}
.catalog-header h1 {
  color: #0d2340;
  margin-bottom: 0.75rem;
}
.catalog-header .lede {
  font-size: 1.1rem;
  color: #4b5563;
  line-height: 1.6;
  max-width: 70ch;
  margin: 0 auto;
}

.catalog-section {
  margin-bottom: 4rem;
}
.catalog-section h2 {
  color: #0d2340;
  font-size: 1.8rem;
  margin-bottom: 1.5rem;
  padding-bottom: 0.5rem;
  border-bottom: 3px solid #cc5500;
}

.catalog-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  gap: 1.5rem;
}

.catalog-card {
  display: flex;
  flex-direction: column;
  border: 1px solid #e5e7eb;
  border-radius: 12px;
  overflow: hidden;
  background: #fff;
  transition: all 0.3s;
  text-decoration: none;
  color: inherit;
}
.catalog-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 12px 24px rgba(0, 0, 0, 0.1);
  border-color: #cc5500;
}

.catalog-image {
  width: 100%;
  height: 200px;
  background: #f8f9fb;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
}
.catalog-image img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.catalog-content {
  padding: 1.25rem;
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  flex: 1;
}

.catalog-category {
  color: #cc5500;
  font-size: 0.75rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  margin: 0;
}

.catalog-content h3 {
  color: #0d2340;
  margin: 0;
  font-size: 1.1rem;
  line-height: 1.3;
}

.catalog-description {
  color: #6b7280;
  font-size: 0.9rem;
  line-height: 1.5;
  margin: 0;
  flex: 1;
}

.catalog-slug {
  color: #0d2340;
  font-family: 'Courier New', Courier, monospace;
  font-size: 0.85rem;
  background: #f8f9fb;
  padding: 0.5rem;
  border-radius: 6px;
  margin: 0;
  font-weight: 600;
  border: 1px solid #e5e7eb;
}

.link-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(230px, 1fr));
  gap: 1rem;
}
.link-grid ul {
  padding-left: 1rem;
}

#library {
  margin-top: 4rem;
  padding-top: 2rem;
  border-top: 2px solid #e5e7eb;
}
#library h2 {
  color: #0d2340;
  margin-bottom: 0.75rem;
}
#library > p {
  color: #6b7280;
  margin-bottom: 2rem;
}
</style>
