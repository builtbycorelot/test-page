---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import { absoluteUrl, getBasePath, prefixWithBase } from '../utils/paths';

const plans = (await getCollection('plans')).sort((a, b) => b.data.sqft - a.data.sqft);
const land = (await getCollection('land')).sort((a, b) => a.data.address.localeCompare(b.data.address));
const basePath = getBasePath(Astro.site);

// Main site pages with hero images and enhanced descriptions
const sitePages = [
  {
    title: 'About CORELOT',
    slug: '/about',
    description: 'Learn our story, service area across Northern & Central Virginia, what drives our builder-first approach, and why we partner exclusively with WL Martin Homes designs for predictable quality.',
    heroImage: '/images/brands/corelot.svg',
    category: 'Company'
  },
  {
    title: 'Build Process',
    slug: '/process',
    description: 'Complete 8-phase build timeline from initial consultation through design retainer, permitting, site preparation, construction milestones, and final walkthrough. Includes FAQs and communication approach.',
    heroImage: '/images/brands/corelot.svg',
    category: 'Resources'
  },
  {
    title: 'Financing Guide',
    slug: '/financing',
    description: 'Understand construction-to-permanent loans, budget components (land, site work, plans, construction), design retainer benefits, example project costs, and our trusted lender partners.',
    heroImage: '/images/brands/corelot.svg',
    category: 'Resources'
  },
  {
    title: 'Frequently Asked Questions',
    slug: '/faq',
    description: 'Comprehensive FAQ covering getting started, land requirements, process timeline, financing options, design choices, construction phases, service area, and post-completion support.',
    heroImage: '/images/brands/corelot.svg',
    category: 'Resources'
  },
  {
    title: 'Contact Us',
    slug: '/contact',
    description: 'Schedule a complimentary consultation to discuss your homesite and project goals. Includes contact information, what to prepare, and next steps after initial inquiry.',
    heroImage: '/images/brands/corelot.svg',
    category: 'Company'
  },
  {
    title: 'Floor Plans Library',
    slug: '/plans',
    description: `Browse all ${plans.length} CORELOT and WL Martin floor plans with square footage, bed/bath counts, galleries, and structural options. Each plan validated as code with consistent slugs and metadata.`,
    heroImage: '/images/brands/corelot.svg',
    category: 'Catalog'
  },
  {
    title: 'Available Homesites',
    slug: '/land',
    description: `Explore ${land.length} CORELOT-ready land packages across Virginia with status, location details, gallery images, and WL Martin plan compatibility guidance. All listings validated before publishing.`,
    heroImage: '/images/brands/corelot.svg',
    category: 'Catalog'
  },
];

const assetPages = [
  { title: 'Brand capability matrix', href: '/assets/brand-capability-matrix.html' },
  { title: 'Brand guide', href: '/assets/brand-guide.html' },
  { title: 'Community brochure', href: '/assets/community-brochure.html' },
  { title: 'Email template', href: '/assets/email-template.html' },
  { title: 'House plan brochures', href: '/assets/house-plan-brochures.html' },
  { title: 'Single home email', href: '/assets/single-home-email.html' },
  { title: 'Single home social', href: '/assets/single-home-social.html' },
  { title: 'Site plan exhibit', href: '/assets/site-plan-exhibit.html' },
  { title: 'Spot lot flyer', href: '/assets/spot-lot-flyer.html' },
  { title: 'Subdivision email', href: '/assets/subdivision-email.html' }
];

const marketingPages = [
  { title: 'Add Scott Hine', href: '/marketing/add-scott-hine.html' },
  { title: 'Analytics', href: '/marketing/analytics.html' },
  { title: 'Google Ads', href: '/marketing/google-ads.html' },
  { title: 'Houzz', href: '/marketing/houzz.html' },
  { title: 'Lot catalog', href: '/marketing/lot-catalog.html' },
  { title: 'Plan catalog', href: '/marketing/plan-catalog.html' },
  { title: 'White Oak sign', href: '/marketing/white-oak-sign.html' }
];

const blogPages = [
  'add-value-home','affordable-meaning','beautiful-lawn-guide','build-on-your-lot','construction-perm-loan-benefits','corelot-design-process','corelot-products','financing-overview','home-style-selection','house-lot-options','house-match','lot-affordability','lot-feasibility','low-maintenance-homes','planning-pricing-wlmartin','production-vs-custom','restaurant-vs-builder','sales-process','the-lot','warranty-cost','what-is-quality','who-is-corelot','why-rent-own'
].map((slug) => ({
  title: slug.split('-').map((part) => part.charAt(0).toUpperCase() + part.slice(1)).join(' '),
  href: `/blogs/${slug}.html`
}));

const otherPages = [
  { title: 'Legacy index', href: '/legacy-index.html' },
  { title: 'Operations map', href: '/CORELOT%20Operations%20Map.html' },
  { title: 'Invoice & Statement Standard', href: '/INVOICE_AND_STATEMENT_STANDARD.md' }
];

const structuredData = [
  {
    '@context': 'https://schema.org',
    '@type': 'ItemList',
    name: 'CORELOT Plans',
    itemListElement: plans.map((plan, index) => ({
      '@type': 'ListItem',
      position: index + 1,
      url: absoluteUrl(`/plans/${plan.id}/`, Astro.site),
      name: plan.data.title,
    })),
  },
  {
    '@context': 'https://schema.org',
    '@type': 'ItemList',
    name: 'Available Land',
    itemListElement: land.map((lot, index) => ({
      '@type': 'ListItem',
      position: index + 1,
      url: absoluteUrl(`/land/${lot.id}/`, Astro.site),
      name: lot.data.address,
    })),
  },
];
---
<BaseLayout
  title="CORELOT Homes | Site Catalog"
  description="Browse all pages, floor plans, and resources for CORELOT Homes—your on-your-lot builder in Virginia."
  canonicalPath="/"
  structuredData={structuredData}
>
  <header class="catalog-header">
    <div class="relaunch-banner">
      <h1>CORELOT Homes — Relaunched</h1>
      <p class="relaunch-tagline">On-your-lot custom homes built with transparency, process discipline, and proven WL Martin designs.</p>
      <p class="relaunch-description">This site is built with Astro, validated as code, and structured for clarity. Every page, plan, and homesite is cataloged below with its URL slug for direct access.</p>
    </div>

    <div class="catalog-intro">
      <h2>Complete Site Catalog</h2>
      <p class="lede">Browse all pages, floor plans, homesites, and resources. Each item displays its slug (URL path) for easy reference and navigation.</p>
    </div>
  </header>

  <section class="catalog-section">
    <div class="section-header">
      <h2>Core Pages</h2>
      <p class="section-description">Essential information about CORELOT, the build process, financing, and how to get started.</p>
    </div>
    <div class="catalog-grid">
      {sitePages.map((page) => (
        <a href={prefixWithBase(page.slug, basePath)} class="catalog-card">
          <div class="catalog-image">
            <img src={prefixWithBase(page.heroImage, basePath)} alt={page.title} />
          </div>
          <div class="catalog-content">
            <p class="catalog-category">{page.category}</p>
            <h3>{page.title}</h3>
            <p class="catalog-description">{page.description}</p>
            <p class="catalog-slug">{prefixWithBase(page.slug, basePath)}</p>
          </div>
        </a>
      ))}
    </div>
  </section>

  <section class="catalog-section">
    <div class="section-header">
      <h2>Floor Plans ({plans.length})</h2>
      <p class="section-description">Complete CORELOT and WL Martin Homes collection. Each plan page includes galleries, specifications, structural options, and pricing guidance. Sorted by square footage (largest first).</p>
    </div>
    <div class="catalog-grid">
      {plans.map((plan) => (
        <a href={prefixWithBase(`/plans/${plan.id}/`, basePath)} class="catalog-card">
          <div class="catalog-image">
            <img src={prefixWithBase(plan.data.heroImage, basePath)} alt={plan.data.title} />
          </div>
          <div class="catalog-content">
            <p class="catalog-category">{plan.data.category}</p>
            <h3>{plan.data.title}</h3>
            <p class="catalog-description">{plan.data.sqft} sqft • {plan.data.beds} beds • {plan.data.baths} baths</p>
            <p class="catalog-slug">{prefixWithBase(`/plans/${plan.id}/`, basePath)}</p>
          </div>
        </a>
      ))}
    </div>
  </section>

  <section class="catalog-section">
    <div class="section-header">
      <h2>Available Homesites ({land.length})</h2>
      <p class="section-description">CORELOT-ready land packages across Northern and Central Virginia. Each listing includes location details, availability status, site photos, and compatible floor plan recommendations.</p>
    </div>
    <div class="catalog-grid">
      {land.map((parcel) => (
        <a href={prefixWithBase(`/land/${parcel.id}/`, basePath)} class="catalog-card">
          <div class="catalog-image">
            <img src={prefixWithBase(parcel.data.heroImage, basePath)} alt={parcel.data.address} />
          </div>
          <div class="catalog-content">
            <p class="catalog-category">Homesite</p>
            <h3>{parcel.data.address}</h3>
            <p class="catalog-description">{parcel.data.status}</p>
            <p class="catalog-slug">{prefixWithBase(`/land/${parcel.id}/`, basePath)}</p>
          </div>
        </a>
      ))}
    </div>
  </section>

  <section id="library">
    <div class="library-header">
      <h2>Additional Resources & Archives</h2>
      <p class="library-description">Legacy content, marketing materials, design assets, and educational blog posts. All static HTML preserved from previous site versions.</p>
    </div>
    <div class="link-grid">
      <div class="link-category">
        <h3>Educational Content (23 Posts)</h3>
        <p class="category-description">In-depth articles about building, financing, design, and land selection</p>
        <ul>
          {blogPages.map((page) => (
            <li><a href={prefixWithBase(page.href, basePath)}>{page.title}</a></li>
          ))}
        </ul>
      </div>
      <div class="link-category">
        <h3>Marketing Tools (7 Items)</h3>
        <p class="category-description">Plan catalogs, analytics setup, advertising guides, and signage templates</p>
        <ul>
          {marketingPages.map((page) => (
            <li><a href={prefixWithBase(page.href, basePath)}>{page.title}</a></li>
          ))}
        </ul>
      </div>
      <div class="link-category">
        <h3>Design Assets (10 Items)</h3>
        <p class="category-description">Brand guidelines, templates, brochures, and marketing collateral</p>
        <ul>
          {assetPages.map((page) => (
            <li><a href={prefixWithBase(page.href, basePath)}>{page.title}</a></li>
          ))}
        </ul>
      </div>
      <div class="link-category">
        <h3>Quick Links</h3>
        <p class="category-description">Direct access to main Astro-powered pages</p>
        <ul>
          <li><a href={prefixWithBase('/plans', basePath)}>{prefixWithBase('/plans', basePath)} — Floor Plans Index</a></li>
          <li><a href={prefixWithBase('/land', basePath)}>{prefixWithBase('/land', basePath)} — Available Homesites</a></li>
          <li><a href={prefixWithBase('/about', basePath)}>{prefixWithBase('/about', basePath)} — About CORELOT</a></li>
          <li><a href={prefixWithBase('/process', basePath)}>{prefixWithBase('/process', basePath)} — Build Process</a></li>
          <li><a href={prefixWithBase('/financing', basePath)}>{prefixWithBase('/financing', basePath)} — Financing Guide</a></li>
          <li><a href={prefixWithBase('/faq', basePath)}>{prefixWithBase('/faq', basePath)} — FAQ</a></li>
          <li><a href={prefixWithBase('/contact', basePath)}>{prefixWithBase('/contact', basePath)} — Contact Us</a></li>
        </ul>
      </div>
      <div class="link-category">
        <h3>Archive & Reference</h3>
        <p class="category-description">Legacy pages and operational documentation</p>
        <ul>
          {otherPages.map((page) => (
            <li><a href={prefixWithBase(page.href, basePath)}>{page.title}</a></li>
          ))}
        </ul>
      </div>
    </div>
  </section>
</BaseLayout>

<style>
.catalog-header {
  margin-bottom: 3rem;
}

.relaunch-banner {
  text-align: center;
  background: linear-gradient(135deg, #0d2340 0%, #16325b 100%);
  color: #fff;
  padding: 3rem 2rem;
  border-radius: 16px;
  margin-bottom: 3rem;
  box-shadow: 0 8px 24px rgba(13, 35, 64, 0.2);
}
.relaunch-banner h1 {
  color: #fff;
  font-size: 2.5rem;
  margin: 0 0 1rem;
  letter-spacing: -0.02em;
}
.relaunch-tagline {
  font-size: 1.3rem;
  color: #f18f01;
  font-weight: 600;
  margin: 0 0 1rem;
  line-height: 1.4;
}
.relaunch-description {
  font-size: 1.05rem;
  color: #cbd5e1;
  line-height: 1.7;
  max-width: 75ch;
  margin: 0 auto;
}

.catalog-intro {
  text-align: center;
  padding-bottom: 2rem;
  border-bottom: 2px solid #e5e7eb;
}
.catalog-intro h2 {
  color: #0d2340;
  margin-bottom: 0.75rem;
}
.catalog-intro .lede {
  font-size: 1.1rem;
  color: #4b5563;
  line-height: 1.6;
  max-width: 70ch;
  margin: 0 auto;
}

.catalog-section {
  margin-bottom: 4rem;
}

.section-header {
  margin-bottom: 2rem;
}
.section-header h2 {
  color: #0d2340;
  font-size: 1.8rem;
  margin-bottom: 0.5rem;
  padding-bottom: 0.5rem;
  border-bottom: 3px solid #cc5500;
}
.section-description {
  color: #6b7280;
  font-size: 1.05rem;
  line-height: 1.6;
  margin-top: 0.75rem;
}

.catalog-section h2 {
  color: #0d2340;
  font-size: 1.8rem;
  margin-bottom: 1.5rem;
  padding-bottom: 0.5rem;
  border-bottom: 3px solid #cc5500;
}

.catalog-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  gap: 1.5rem;
}

.catalog-card {
  display: flex;
  flex-direction: column;
  border: 1px solid #e5e7eb;
  border-radius: 12px;
  overflow: hidden;
  background: #fff;
  transition: all 0.3s;
  text-decoration: none;
  color: inherit;
}
.catalog-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 12px 24px rgba(0, 0, 0, 0.1);
  border-color: #cc5500;
}

.catalog-image {
  width: 100%;
  height: 200px;
  background: #f8f9fb;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
}
.catalog-image img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.catalog-content {
  padding: 1.25rem;
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  flex: 1;
}

.catalog-category {
  color: #cc5500;
  font-size: 0.75rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  margin: 0;
}

.catalog-content h3 {
  color: #0d2340;
  margin: 0;
  font-size: 1.1rem;
  line-height: 1.3;
}

.catalog-description {
  color: #6b7280;
  font-size: 0.9rem;
  line-height: 1.5;
  margin: 0;
  flex: 1;
}

.catalog-slug {
  color: #0d2340;
  font-family: 'Courier New', Courier, monospace;
  font-size: 0.85rem;
  background: #f8f9fb;
  padding: 0.5rem;
  border-radius: 6px;
  margin: 0;
  font-weight: 600;
  border: 1px solid #e5e7eb;
}

.link-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(230px, 1fr));
  gap: 1rem;
}
.link-grid ul {
  padding-left: 1rem;
}

#library {
  margin-top: 4rem;
  padding-top: 2rem;
  border-top: 2px solid #e5e7eb;
}

.library-header {
  margin-bottom: 2.5rem;
  text-align: center;
}
.library-header h2 {
  color: #0d2340;
  margin-bottom: 0.75rem;
  font-size: 1.8rem;
}
.library-description {
  color: #6b7280;
  font-size: 1.05rem;
  line-height: 1.6;
  max-width: 70ch;
  margin: 0 auto;
}

.link-category {
  background: #f8f9fb;
  padding: 1.5rem;
  border-radius: 12px;
  border: 1px solid #e5e7eb;
}
.link-category h3 {
  color: #0d2340;
  margin-top: 0;
  margin-bottom: 0.5rem;
  font-size: 1.15rem;
  padding-bottom: 0.5rem;
  border-bottom: 2px solid #cc5500;
}
.category-description {
  color: #6b7280;
  font-size: 0.9rem;
  line-height: 1.5;
  margin-bottom: 1rem;
  font-style: italic;
}
</style>
