---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getEntry, getCollection } from 'astro:content';

const { slug } = Astro.params;
const plan = await getEntry('plans', slug!);

if (!plan) {
  throw new Error(`Plan not found for slug ${slug}`);
}

const breadcrumbLd = {
  '@context': 'https://schema.org',
  '@type': 'BreadcrumbList',
  itemListElement: [
    { '@type': 'ListItem', position: 1, name: 'Plans', item: '/plans/' },
    { '@type': 'ListItem', position: 2, name: plan.data.title, item: `/plans/${plan.slug}/` },
  ],
};

const related = (await getCollection('plans')).filter((item) => item.slug !== plan.slug).slice(0, 2);
---
<BaseLayout
  title={`${plan.data.title} | CORELOT Plan`}
  description={plan.data.summary}
  canonicalPath={`/plans/${plan.slug}/`}
  structuredData={breadcrumbLd}
>
  <header class="page-header">
    <p class="pill">WL Martin Homes Plan</p>
    <h1>{plan.data.title}</h1>
    <p class="stats">{plan.data.sqft} sqft • {plan.data.beds} beds • {plan.data.baths} baths</p>
    <p class="lede">{plan.data.summary}</p>
  </header>

  <img class="hero" src={plan.data.heroImage} alt={`${plan.data.title} rendering`} />

  <section class="details">
    <div>
      <h2>Highlights</h2>
      <ul>
        <li>Designed for daylight and sightlines inspired by WL Martin Homes.</li>
        <li>Pre-wired for ENERGY STAR-friendly mechanical selections.</li>
        <li>Ready for CORELOT land packages across Virginia and the DC metro.</li>
      </ul>
    </div>
    <div>
      <h2>Gallery</h2>
      <div class="gallery">
        {plan.data.gallery.map((image) => (
          <img src={image} alt={`${plan.data.title} gallery`} loading="lazy" />
        ))}
      </div>
    </div>
  </section>

  {related.length > 0 && (
    <section>
      <h2>More plans to explore</h2>
      <div class="grid">
        {related.map((item) => <a class="inline-card" href={`/plans/${item.slug}/`}>{item.data.title}</a>)}
      </div>
    </section>
  )}
</BaseLayout>

<style>
.page-header { margin-bottom: 1rem; }
.stats { color: #4b5563; }
.lede { color: #4b5563; max-width: 70ch; }
.hero {
  width: 100%;
  max-height: 420px;
  object-fit: cover;
  border-radius: 12px;
  border: 1px solid #ececec;
}
.details {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
  gap: 1.5rem;
  margin-top: 1.5rem;
}
.gallery {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
  gap: 0.75rem;
}
.gallery img {
  width: 100%;
  border-radius: 10px;
  border: 1px solid #ececec;
}
.grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
  gap: 0.75rem;
}
.inline-card {
  display: block;
  border: 1px solid #ececec;
  border-radius: 10px;
  padding: 0.75rem 0.9rem;
  background: #f8f9fb;
  color: #0d2340;
  text-decoration: none;
  font-weight: 700;
}
.inline-card:hover { border-color: #cc5500; }
</style>
